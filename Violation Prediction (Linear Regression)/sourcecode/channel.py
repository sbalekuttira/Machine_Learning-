import pandas as pd
import matplotlib.pyplot as plt
import numpy as np
from statistics import mean
#from datatype import total_cost

#total number of violations of first month for each medium of violation
datakey = pd.read_csv('channel0.csv', sep="\t", header = None,encoding='utf-8')
datakey.columns = ["eid","email","web","usb","prints"]
rowcountkey=len(datakey.index)

usb0_sum=0
email0_sum=0
web0_sum=0
usb0_sum=0
print0_sum=0

for i in range(rowcountkey):
	email0_sum=datakey.email[i]+email0_sum
	web0_sum=datakey.web[i]+web0_sum
	usb0_sum=datakey.usb[i]+usb0_sum
	print0_sum=datakey.prints[i]+print0_sum
	

datakey = pd.read_csv('channel1.csv', sep="\t", header = None,encoding='utf-8')
datakey.columns = ["eid","email","web","usb","prints"]
rowcountkey=len(datakey.index)

usb1_sum=0
email1_sum=0
web1_sum=0
usb1_sum=0
print1_sum=0

for i in range(rowcountkey):
	email1_sum=datakey.email[i]+email1_sum
	web1_sum=datakey.web[i]+web1_sum
	usb1_sum=datakey.usb[i]+usb1_sum
	print1_sum=datakey.prints[i]+print1_sum
	
datakey = pd.read_csv('channel2.csv', sep="\t", header = None,encoding='utf-8')
datakey.columns = ["eid","email","web","usb","prints"]
rowcountkey=len(datakey.index)

usb2_sum=0
email2_sum=0
web2_sum=0
usb2_sum=0
print2_sum=0

for i in range(rowcountkey):
	email2_sum=datakey.email[i]+email2_sum
	web2_sum=datakey.web[i]+web2_sum
	usb2_sum=datakey.usb[i]+usb2_sum
	print2_sum=datakey.prints[i]+print2_sum

datakey = pd.read_csv('channel3.csv', sep="\t", header = None,encoding='utf-8')
datakey.columns = ["eid","email","web","usb","prints"]
rowcountkey=len(datakey.index)

usb3_sum=0
email3_sum=0
web3_sum=0
usb3_sum=0
print3_sum=0

for i in range(rowcountkey):
	email3_sum=datakey.email[i]+email3_sum
	web3_sum=datakey.web[i]+web3_sum
	usb3_sum=datakey.usb[i]+usb3_sum
	print3_sum=datakey.prints[i]+print3_sum
	
datakey = pd.read_csv('channel4.csv', sep="\t", header = None,encoding='utf-8')
datakey.columns = ["eid","email","web","usb","prints"]
rowcountkey=len(datakey.index)

usb4_sum=0
email4_sum=0
web4_sum=0
usb4_sum=0
print4_sum=0

for i in range(rowcountkey):
	email4_sum=datakey.email[i]+email4_sum
	web4_sum=datakey.web[i]+web4_sum
	usb4_sum=datakey.usb[i]+usb4_sum
	print4_sum=datakey.prints[i]+print4_sum
	
datakey = pd.read_csv('channel5.csv', sep="\t", header = None,encoding='utf-8')
datakey.columns = ["eid","email","web","usb","prints"]
rowcountkey=len(datakey.index)

usb5_sum=0
email5_sum=0
web5_sum=0
usb5_sum=0
print5_sum=0

for i in range(rowcountkey):
	email5_sum=datakey.email[i]+email5_sum
	web5_sum=datakey.web[i]+web5_sum
	usb5_sum=datakey.usb[i]+usb5_sum
	print5_sum=datakey.prints[i]+print5_sum
	

datakey = pd.read_csv('channel6.csv', sep="\t", header = None,encoding='utf-8')
datakey.columns = ["eid","email","web","usb","prints"]
rowcountkey=len(datakey.index)

usb6_sum=0
email6_sum=0
web6_sum=0
usb6_sum=0
print6_sum=0

for i in range(rowcountkey):
	email6_sum=datakey.email[i]+email6_sum
	web6_sum=datakey.web[i]+web6_sum
	usb6_sum=datakey.usb[i]+usb6_sum
	print6_sum=datakey.prints[i]+print6_sum
	

datakey = pd.read_csv('channel7.csv', sep="\t", header = None,encoding='utf-8')
datakey.columns = ["eid","email","web","usb","prints"]
rowcountkey=len(datakey.index)

usb7_sum=0
email7_sum=0
web7_sum=0
usb7_sum=0
print7_sum=0

for i in range(rowcountkey):
	email7_sum=datakey.email[i]+email7_sum
	web7_sum=datakey.web[i]+web7_sum
	usb7_sum=datakey.usb[i]+usb7_sum
	print7_sum=datakey.prints[i]+print7_sum
	
datakey = pd.read_csv('channel8.csv', sep="\t", header = None,encoding='utf-8')
datakey.columns = ["eid","email","web","usb","prints"]
rowcountkey=len(datakey.index)

usb8_sum=0
email8_sum=0
web8_sum=0
usb8_sum=0
print8_sum=0

for i in range(rowcountkey):
	email8_sum=datakey.email[i]+email8_sum
	web8_sum=datakey.web[i]+web8_sum
	usb8_sum=datakey.usb[i]+usb8_sum
	print8_sum=datakey.prints[i]+print8_sum

datakey = pd.read_csv('channel9.csv', sep="\t", header = None,encoding='utf-8')
datakey.columns = ["eid","email","web","usb","prints"]
rowcountkey=len(datakey.index)

usb9_sum=0
email9_sum=0
web9_sum=0
usb9_sum=0
print9_sum=0

for i in range(rowcountkey):
	email9_sum=datakey.email[i]+email9_sum
	web9_sum=datakey.web[i]+web9_sum
	usb9_sum=datakey.usb[i]+usb9_sum
	print9_sum=datakey.prints[i]+print9_sum

datakey = pd.read_csv('channel10.csv', sep="\t", header = None,encoding='utf-8')
datakey.columns = ["eid","email","web","usb","prints"]
rowcountkey=len(datakey.index)

usb10_sum=0
email10_sum=0
web10_sum=0
usb10_sum=0
print10_sum=0

for i in range(rowcountkey):
	email10_sum=datakey.email[i]+email10_sum
	web10_sum=datakey.web[i]+web10_sum
	usb10_sum=datakey.usb[i]+usb10_sum
	print10_sum=datakey.prints[i]+print10_sum

datakey = pd.read_csv('channel11.csv', sep="\t", header = None,encoding='utf-8')
datakey.columns = ["eid","email","web","usb","prints"]
rowcountkey=len(datakey.index)

usb11_sum=0
email11_sum=0
web11_sum=0
usb11_sum=0
print11_sum=0

for i in range(rowcountkey):
	email11_sum=datakey.email[i]+email11_sum
	web11_sum=datakey.web[i]+web11_sum
	usb11_sum=datakey.usb[i]+usb11_sum
	print11_sum=datakey.prints[i]+print11_sum

#xs is the months
xs=np.array([1,2,3,4,5,6,7,8,9,10,11,12])

#all the y's
ys_email=np.array([email0_sum,email1_sum,email2_sum,email3_sum,email4_sum,email5_sum,email6_sum,email7_sum,email8_sum,email9_sum,email10_sum,email11_sum])

ys_web=np.array([web0_sum,web1_sum,web2_sum,web3_sum,web4_sum,web5_sum,web6_sum,web7_sum,web8_sum,web9_sum,web10_sum,web11_sum])


ys_usb=np.array([usb0_sum,usb1_sum,usb2_sum,usb3_sum,usb4_sum,usb5_sum,usb6_sum,usb7_sum,usb8_sum,usb9_sum,usb10_sum,usb11_sum])

ys_prints=np.array([print0_sum,print1_sum,print2_sum,print3_sum,print4_sum,print5_sum,print6_sum,print7_sum,print8_sum,print9_sum,print10_sum,print11_sum])

#hard coded Linear Regression algorithm (BEST FIT LINE)

def best_fit_and_intercept(x,y):
		m= (((mean(x)*mean(y))-mean(x*y))/
	    	((mean(x)**2)-mean(x*x)))
		b=mean(y)-m*(mean(x))
		return m,b


#x_train,x_test,y_train,y_test=cross_validation.train_test_split(xs,ys_email,test_size=0.2)
#clf=LinearRegression()
#clf.fit(x_train,y_train)

#print(clf.score(x_test,y_test))

#regression line for email
m,b=best_fit_and_intercept(xs,ys_email)
regression_line=[(m*x)+b for x in xs]

plt.scatter(xs,ys_email,color='red')
plt.plot(xs,regression_line,color='black')

plt.title('E-MAIL VIOLATIONS')
plt.xlabel('MONTH', fontsize=18)
plt.ylabel('VIOLATIONS', fontsize=16)

#predict any month for email
predict_x=13
predict_email_y=(m*predict_x)+b
plt.scatter(predict_x,predict_email_y,color='blue')
plt.show()


#regression line for web
m,b=best_fit_and_intercept(xs,ys_web)
regression_line=[(m*x)+b for x in xs]

plt.scatter(xs,ys_web,color='yellow')
plt.plot(xs,regression_line,color='black')

plt.title('WEB VIOLATIONS')
plt.xlabel('MONTH', fontsize=18)
plt.ylabel('VIOLATIONS', fontsize=16)

#predict any month for web
predict_x=13
predict_web_y=(m*predict_x)+b
plt.scatter(predict_x,predict_web_y,color='red')
plt.show()



#regression line for usb
m,b=best_fit_and_intercept(xs,ys_usb)
regression_line=[(m*x)+b for x in xs]

plt.scatter(xs,ys_usb,color='orange')
plt.plot(xs,regression_line,color='black')

plt.title('USB VIOLATIONS')
plt.xlabel('MONTH', fontsize=18)
plt.ylabel('VIOLATIONS', fontsize=16)

#predict any month for usb
predict_x=13
predict_usb_y=(m*predict_x)+b
plt.scatter(predict_x,predict_usb_y,color='blue')
plt.show()


#regression line for print
m,b=best_fit_and_intercept(xs,ys_prints)
regression_line=[(m*x)+b for x in xs]

plt.scatter(xs,ys_prints,color='pink')
plt.plot(xs,regression_line,color='black')

plt.title('PRINT VIOLATIONS')
plt.xlabel('MONTH', fontsize=18)
plt.ylabel('VIOLATIONS', fontsize=16)

#predict any month for print
predict_x=13
predict_print_y=(m*predict_x)+b
plt.scatter(predict_x,predict_print_y,color='yellow')
plt.show()


#plt.plot(np.unique(xs), np.poly1d(np.polyfit(xs, ys, 1))(np.unique(xs)),color='black')

#stores all the costs, it will be needed to find total cost

intermediate_costs=[]

#file path for summary sheet
pathout = '/home/jaxqueen/shruti/'
pathout+="estimated_cost_january.txt"
output=open(pathout,'a')
	
output.write("Cost due to the following medium used for information security violation")
output.write("\n")
output.write("\n")
output.write("\n")

#fuction to write to file for each type
def filewrite(predict_type_y,costper_type):
	roundint=int(predict_type_y)
	output.write("%s" %predict_type_y)
	output.write("\n")
	output.write("Round off:"),
	output.write("%s" %roundint)
	output.write("\n")
	output.write("Cost per violation:"),
	output.write("$")
	output.write("%s" %costper_type),
	output.write("\n")
	output.write("Total:"),
	output.write("$")
	total=roundint*costper_type
	intermediate_costs.append(total)
	output.write("%s" %(total))
	output.write("\n")
	output.write("\n")
	output.write("\n")
	output.write("\n")
	


#cost estimates for month of january 

cost_types=np.array([predict_email_y,predict_web_y,predict_usb_y,predict_print_y])

datakeycost = pd.read_csv('cost.csv', sep="\t", header = None,encoding='utf-8')
datakeycost.columns = ["email_cost","web_cost","usb_cost","print_cost","pii_cost","pci_cost","intd_cost","dd_cost","sc_cost","invd_cost","prd_cost"]
rowcountkey=len(datakeycost.index)


output.write("Predicted Number of violations using EMAIL as a medium of INFORMATION VIOLATION:"),
filewrite(predict_email_y,datakeycost.email_cost[0])

output.write("Predicted Number of violations using WEB as a medium of INFORMATION VIOLATION:"),
filewrite(predict_web_y,datakeycost.web_cost[0])

output.write("Predicted Number of violations using USB as a medium of INFORMATION VIOLATION:"),
filewrite(predict_usb_y,datakeycost.usb_cost[0])

output.write("Predicted Number of violations using PRINT as a medium of INFORMATION VIOLATION:"),
filewrite(predict_print_y,datakeycost.print_cost[0])

#calculate total cost

total_cost_this=sum(intermediate_costs)
output.write("TOTAL COST DUE TO ABOVE MEDIUMS USED FOR INFORMATION VIOLATATIONS:"),
output.write("$")
output.write("%s" %total_cost_this)
output.write("\n")
output.write("\n")
output.write("\n")

datatypecost = pd.read_csv('cost_inter.txt', sep="\n", header = None,encoding='utf-8')
datatypecost.columns = ["datatype_cost"]

output.write("ESTIMATED TOTAL (JANUARY) COST :"),
output.write("$")
output.write("%s" %(total_cost_this+datatypecost.datatype_cost[0]))
output.write("\n")
output.write("*****************************************************************************************************") 		



